;/*FB_PKG_DELIM*/

__d("LSGetLatestThreadIds.nop",["I64","LSVec","MAWBridgeSendAndReceive","Promise","ReQL","asyncToGeneratorRuntime","gkx"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a,b){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e){var f=[];e=(yield d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(e.table("mi_act_mapping_table"))).then(function(a){return a.map(function(a){a=a.jid;return d("I64").to_string(a)})}));if(e.length>0){var g=new Set(e);a.forEach(function(a){g.has(a)&&f.push(a)})}return(h||(h=b("Promise"))).resolve([c("LSVec").ofArray(f),!0])});return j.apply(this,arguments)}function k(a,b){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a=(yield d("ReQL").toArrayAsync(d("ReQL").fromTableDescending(a.table("e2ee_threads").index("threadOrder")).take(d("I64").to_int32(b))));return a.map(function(a){a=a.jid;return a.split("@")[0]})});return l.apply(this,arguments)}function m(a){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield d("MAWBridgeSendAndReceive").sendAndReceive("backend","getLatestThreadIds",{numThreads:d("I64").to_int32(a)}));return a});return n.apply(this,arguments)}a=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f,g,j){j===void 0&&(j=!1);if(d("I64").gt(g,d("I64").zero))try{e=c("gkx")("465")?yield k(a,g):yield m(g);return j&&c("gkx")("3741")?i(e,a):(h||(h=b("Promise"))).resolve([c("LSVec").ofArray(e),!0])}catch(a){return(h||(h=b("Promise"))).resolve([c("LSVec").ofArray([]),!1])}return(h||(h=b("Promise"))).resolve([c("LSVec").ofArray([]),!0])});function e(b,c,d,e,f){return a.apply(this,arguments)}return e}();g["default"]=a}),98);
__d("LSFetchAndWriteThreadsToClient",["LSAppendDataTraceAddon","LSArrayGetObjectAt","LSBase64Encode.nop","LSCreateDataTrace","LSCreateDataTraceID.nop","LSFlushDataTrace.nop","LSGetBlobFromString.nop","LSGetLatestThreadIds.nop","LSGetThreadTransportIdFromThreadId.nop","LSHmac_v2.nop","LSIsEncryptionVersionSecure","LSIsMobileClient","LSIssueRestoreTask","LSLogMebClientEvent.nop","LSOcmfClientMap.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1];c.n;var d=[],e=[],f;return c.seq([function(e){return c.seq([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsFetchAndWriteThreadsToClientStoredProcedure] Beginning execution."),a[0]!==f?c.sp(b("LSAppendDataTraceAddon"),a[0],c.i64.cast([0,2500]),c.i64.cast([0,2]),f,f):c.resolve()},function(a){return c.sp(b("LSIsMobileClient")).then(function(a){return a=a,d[1]=a[0],a})},function(a){return d[1]?d[2]=!0:d[2]=!1,d[2]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[27]=c.createArray(),f!==f?d[28]=(d[27].push(f),d[27]):0,c.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[27],c.i64.cast([0,3]))):c.resolve()},function(a){return c.islc(c.ftr(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(a,e){var g=a.done;a=a.value;return g?(g=[f,f,f,f,f,c.i64.cast([0,1]),f,f,f,f,f,f,f,c.i64.cast([0,20])],d[3]=g[0],d[4]=g[1],d[5]=g[2],d[6]=g[3],d[7]=g[4],d[8]=g[5],d[9]=g[6],d[10]=g[7],d[11]=g[8],d[12]=g[9],d[13]=g[10],d[14]=g[11],d[15]=g[12],d[16]=g[13],g):(e=a.item,c.seq([function(a){return d[31]=e.backupTenancy,d[30]=e.encryptionVersion,c.i64.neq(f,f)?c.resolve(d[27]=f):c.seq([function(a){return d[32]=c.createArray(),c.sp(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[33]=a[0],a})},function(a){return d[33]?d[42]=(d[32].push(c.i64.cast([0,0])),d[32]):0,c.sp(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[34]=a[0],a})},function(a){return d[34]?d[42]=(d[32].push(c.i64.cast([0,2])),d[32]):0,c.sp(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[35]=a[0],a})},function(a){return d[35]?d[42]=(d[32].push(c.i64.cast([0,3])),d[32]):0,c.sp(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[36]=a[0],a})},function(a){return d[36]?d[42]=(d[32].push(c.i64.cast([0,4])),d[32]):0,d[37]=c.createArray(),d[38]=c.i64.of_int32(d[32].length),c.i64.gt(d[38],c.i64.cast([0,0]))?c.loopAsync(d[38],function(a){return d[42]=a,c.seq([function(a){return c.ntop("Array",b("LSArrayGetObjectAt"),d[32],d[42]).then(function(a){return a=a,d[43]=a[0],d[44]=a[1],a})},function(a){return d[45]=(d[37].push(d[43]),d[37])}])}):c.resolve()},function(a){return c.seq([function(a){return d[42]=c.createArray(),d[43]=c.i64.of_int32(d[37].length),c.i64.gt(d[43],c.i64.cast([0,0]))?c.loopAsync(d[43],function(a){return d[45]=a,c.seq([function(a){return c.ntop("Array",b("LSArrayGetObjectAt"),d[37],d[45]).then(function(a){return a=a,d[46]=a[0],d[47]=a[1],a})},function(a){return d[48]=(d[42].push(c.i64.to_string(d[46])),d[42])}])}):c.resolve()},function(a){return d[44]=d[42].join(","),d[39]=d[44]}])},function(a){return d[37].some(function(a){return c.i64.eq(d[30],a)})?d[40]=d[30]:d[40]=f,c.i64.neq(d[40],f)?d[41]=d[40]:d[41]=f,d[27]=d[41]}])},function(a){return c.i64.neq(d[27],f)?d[28]=d[27]:d[28]=c.i64.cast([0,0]),c.i64.neq(d[31],f)?d[29]=d[31]:d[29]=c.i64.cast([0,1]),a=[e.backupId,e.deviceId,e.mailboxRootKeyBlob,e.ocmfClientStateBlob,d[28],d[29],e.epochAuthPublicKeyBlob,e.epochAuthPrivateKeyBlob,e.devicePublicKeyBlob,e.devicePrivateKeyBlob,e.epochStoragePublicKeyBlob,e.epochStoragePrivateKeyBlob,e.obliviousValidationTokenBlob,e.authorityLevel],d[3]=a[0],d[4]=a[1],d[5]=a[2],d[6]=a[3],d[7]=a[4],d[8]=a[5],d[9]=a[6],d[10]=a[7],d[11]=a[8],d[12]=a[9],d[13]=a[10],d[14]=a[11],d[15]=a[12],d[16]=a[13],a}]))})},function(e){return c.i64.neq(d[3],f)?c.blobs.neq(d[6],f)?c.seq([function(e){return function(a){c.logger(a).info(a)}(["[EncryptedBackups][LSEncryptedBackupsFetchAndWriteThreadsToClientStoredProcedure] ","",["Restoring ",c.i64.to_string(a[1])," threads"].join("")].join("")),c.i64.eq(d[8],c.i64.cast([0,2]))?c.resolve((d[30]=c.createArray(),d[31]=(d[30].push(c.i64.to_string(c.i64.cast([0,1234567890]))),d[30]),d[27]=d[30])):c.seq([function(e){return c.nop(b("LSGetLatestThreadIds.nop"),"AdvancedCrypto",a[1],!0).then(function(a){return a=a,d[30]=a[0],d[31]=a[1],a})},function(e){return d[31]===!0?c.seq([function(d){return a[0]!==f?c.sp(b("LSAppendDataTraceAddon"),a[0],c.i64.cast([0,2501]),c.i64.cast([0,2]),f,f):c.resolve()},function(a){return c.sp(b("LSIsMobileClient")).then(function(a){return a=a,d[33]=a[0],a})},function(a){return d[33]?d[34]=!0:d[34]=!1,d[34]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[37]=c.createArray(),f!==f?d[38]=(d[37].push(f),d[37]):0,c.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[37],c.i64.cast([0,3]))):c.resolve()},function(a){return d[30]?d[35]=!1:d[35]=!0,d[35]?(function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsFetchAndWriteThreadsToClientStoredProcedure] No thread_ids returned from LSEncryptedBackupsGetLatestThreadIds"),d[37]=c.createArray(),d[36]=d[37]):d[36]=d[30],d[32]=d[36]}]):c.seq([function(d){return a[0]!==f?c.sp(b("LSAppendDataTraceAddon"),a[0],c.i64.cast([0,2502]),c.i64.cast([0,2]),f,f):c.resolve()},function(a){return c.sp(b("LSIsMobileClient")).then(function(a){return a=a,d[33]=a[0],a})},function(a){return d[33]?d[34]=!0:d[34]=!1,d[34]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[37]=c.createArray(),f!==f?d[38]=(d[37].push(f),d[37]):0,c.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[37],c.i64.cast([0,3]))):c.resolve()},function(e){return d[36]="Failed to fetch threads from LSEncryptedBackupsGetLatestThreadIds",d[36]!==f?c.seq([function(e){return d[40]=["[EncryptedBackups][LSEncryptedBackupsFetchAndWriteThreadsToClientStoredProcedure] ","",d[36]].join(""),function(a){c.logger(a).mustfix(a)}(d[40]),d[37]=c.createArray(),a[0]!==f?d[41]=(d[37].push(a[0]),d[37]):0,c.nop(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsFetchAndWriteThreadsToClientStoredProcedure",d[36],d[37],c.i64.cast([0,3]))},function(e){return a[0]!==f?c.seq([function(e){return a[0]!==f?c.sp(b("LSAppendDataTraceAddon"),a[0],c.i64.cast([0,85]),c.i64.cast([0,2]),d[40],f):c.resolve()},function(a){return c.sp(b("LSIsMobileClient")).then(function(a){return a=a,d[41]=a[0],a})},function(a){return d[41]?d[42]=!0:d[42]=!1,d[42]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[43]=c.createArray(),f!==f?d[44]=(d[43].push(f),d[43]):0,c.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[43],c.i64.cast([0,3]))):c.resolve()}]):c.resolve()},function(d){return a[0]!==f?c.nop(b("LSFlushDataTrace.nop"),a[0]):c.resolve()},function(a){return c.sp(b("LSIsMobileClient")).then(function(a){return a=a,d[38]=a[0],a})},function(a){return d[38]?d[39]=!0:d[39]=!1,d[39]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[41]=c.createArray(),f!==f?d[42]=(d[41].push(f),d[41]):0,c.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[41],c.i64.cast([0,3]))):c.resolve()}]):c.seq([function(e){return a[0]!==f?c.seq([function(d){return a[0]!==f?c.sp(b("LSAppendDataTraceAddon"),a[0],c.i64.cast([0,85]),c.i64.cast([0,2]),["[EncryptedBackups][LSEncryptedBackupsFetchAndWriteThreadsToClientStoredProcedure] ","",""].join(""),f):c.resolve()},function(a){return c.sp(b("LSIsMobileClient")).then(function(a){return a=a,d[39]=a[0],a})},function(a){return d[39]?d[40]=!0:d[40]=!1,d[40]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[41]=c.createArray(),f!==f?d[42]=(d[41].push(f),d[41]):0,c.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[41],c.i64.cast([0,3]))):c.resolve()}]):c.resolve()},function(d){return a[0]!==f?c.nop(b("LSFlushDataTrace.nop"),a[0]):c.resolve()},function(a){return c.sp(b("LSIsMobileClient")).then(function(a){return a=a,d[37]=a[0],a})},function(a){return d[37]?d[38]=!0:d[38]=!1,d[38]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[39]=c.createArray(),f!==f?d[40]=(d[39].push(f),d[39]):0,c.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[39],c.i64.cast([0,3]))):c.resolve()}])},function(a){return d[35]=c.createArray(),d[32]=d[35]}])},function(a){return d[27]=d[32]}])},function(a){return d[28]=c.i64.of_int32(d[27].length),function(a){c.logger(a).info(a)}(["[EncryptedBackups][LSEncryptedBackupsFetchAndWriteThreadsToClientStoredProcedure] ","",["Restored ",c.i64.to_string(d[28])," threads"].join("")].join("")),c.fe(c.db.table(231).fetch(),function(a){return a["delete"]()})},function(a){return d[29]=c.i64.of_int32(d[27].length),c.i64.gt(d[29],c.i64.cast([0,0]))?c.loopAsync(d[29],function(a){return d[30]=a,c.seq([function(a){return c.ntop("Array",b("LSArrayGetObjectAt"),d[27],d[30]).then(function(a){return a=a,d[31]=a[0],d[32]=a[1],a})},function(a){return c.nop(b("LSGetBlobFromString.nop"),d[31]).then(function(a){return a=a,d[33]=a[0],a})},function(a){return c.nop(b("LSHmac_v2.nop"),c.blob("dGhyZWFkX2lkX3Njb3Bl"),d[33]).then(function(a){return a=a,d[34]=a[0],a})},function(a){return c.nop(b("LSOcmfClientMap.nop"),d[6],d[34]).then(function(a){return a=a,d[35]=a[0],a})},function(a){return c.nop(b("LSBase64Encode.nop"),d[35]).then(function(a){return a=a,d[36]=a[0],a})},function(a){return d[53]=d[36]==null?"":d[36],c.islc(c.ftr(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))&&c.i64.eq(a.backupTenancy,c.i64.cast([0,2]))}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(a,b){b=a.done;a=a.value;return b?d[37]=!1:(a.item,d[37]=!0)})},function(a){return d[37]?d[39]=c.i64.or_(c.i64.cast([0,73]),c.i64.cast([0,128])):d[39]=c.i64.cast([0,73]),c.nop(b("LSCreateDataTraceID.nop")).then(function(a){return a=a,d[40]=a[0],a})},function(a){return d[41]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][MEBTraceUtils] ",d[41],"EncryptedBackups MCD Trace ID",d[41],c.i64.to_string(d[39])].join("")),c.sp(b("LSCreateDataTrace"),d[40],f,f,"restore_messages",d[39])},function(a){return c.sp(b("LSIsMobileClient")).then(function(a){return a=a,d[42]=a[0],a})},function(a){return d[42]?d[43]=!0:d[43]=!1,d[43]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[54]=c.createArray(),f!==f?d[55]=(d[54].push(f),d[54]):0,c.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[54],c.i64.cast([0,3]))):c.resolve()},function(a){return d[40]!==f?c.sp(b("LSAppendDataTraceAddon"),d[40],c.i64.cast([0,2503]),c.i64.cast([0,2]),f,f):c.resolve()},function(a){return c.sp(b("LSIsMobileClient")).then(function(a){return a=a,d[44]=a[0],a})},function(a){return d[44]?d[45]=!0:d[45]=!1,d[45]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[54]=c.createArray(),f!==f?d[55]=(d[54].push(f),d[54]):0,c.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[54],c.i64.cast([0,3]))):c.resolve()},function(a){return c.nop(b("LSGetBlobFromString.nop"),c.i64.to_string(d[3])).then(function(a){return a=a,d[46]=a[0],a})},function(a){return c.nop(b("LSHmac_v2.nop"),c.blob("bWFpbGJveF9pZF9zY29wZQ=="),d[46]).then(function(a){return a=a,d[47]=a[0],a})},function(a){return c.nop(b("LSOcmfClientMap.nop"),d[6],d[47]).then(function(a){return a=a,d[48]=a[0],a})},function(a){return c.nop(b("LSBase64Encode.nop"),d[48]).then(function(a){return a=a,d[49]=a[0],a})},function(a){return d[31]!==f?c.seq([function(a){return c.nop(b("LSGetThreadTransportIdFromThreadId.nop"),d[31]).then(function(a){return a=a,d[54]=a[0],a})},function(a){return c.i64.neq(d[54],f)?c.seq([function(a){return c.db.table(173).fetch([[[d[54]]],"jid"]).next().then(function(a,b){var e=a.done;a=a.value;return e?d[56]=f:(b=a.item,d[56]=c.i64.to_string(b.serverThreadKey))})},function(a){return d[55]=d[56]}]):c.seq([function(a){return function(a){c.logger(a).warn(a)}("[EncryptedBackups][MEBTableUtils] Failed to get server thread key, wa jid is null"),d[56]=c.createArray(),f!==f?d[57]=(d[56].push(f),d[56]):0,c.nop(b("LSLogMebClientEvent.nop"),"MEBTableUtils","Failed to get server thread key, wa jid is null",d[56],c.i64.cast([0,2]))},function(a){return d[55]=f}])},function(a){return d[50]=d[55]}]):c.seq([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTableUtils] Failed to get server thread key, thread id is null"),d[54]=c.createArray(),f!==f?d[55]=(d[54].push(f),d[54]):0,c.nop(b("LSLogMebClientEvent.nop"),"MEBTableUtils","Failed to get server thread key, thread id is null",d[54],c.i64.cast([0,3]))},function(a){return d[50]=f}])},function(a){return c.nop(b("LSGetThreadTransportIdFromThreadId.nop"),d[31]).then(function(a){return a=a,d[51]=a[0],a})},function(a){return c.sp(b("LSIssueRestoreTask"),d[49]==null?"":d[49],d[53],c.i64.cast([0,20]),c.i64.cast([0,1]),f,d[40],!1,c.i64.cast([0,0]),f,d[50],d[51]).then(function(a){return a=a,d[52]=a[0],a})},function(a){return c.i64.neq(d[52],f)?c.seq([function(a){return c.db.table(180).add({taskId:d[52],listId:d[53],threadId:d[31]})},function(a){return d[54]=c.i64.of_float(Date.now()),c.db.table(231).add({threadId:d[31],lastUpdated:d[54],restoreStatus:c.i64.cast([0,1])})},function(a){return d[40]!==f?c.sp(b("LSAppendDataTraceAddon"),d[40],c.i64.cast([0,3602]),c.i64.cast([0,2]),f,f):c.resolve()},function(a){return c.sp(b("LSIsMobileClient")).then(function(a){return a=a,d[55]=a[0],a})},function(a){return d[55]?d[56]=!0:d[56]=!1,d[56]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[57]=c.createArray(),f!==f?d[58]=(d[57].push(f),d[57]):0,c.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[57],c.i64.cast([0,3]))):c.resolve()}]):c.resolve()}])}):c.resolve()}]):(d[27]="missing ocmf_client_state for restore",d[27]!==f?c.seq([function(e){return d[31]=["[EncryptedBackups][LSEncryptedBackupsFetchAndWriteThreadsToClientStoredProcedure] ","",d[27]].join(""),function(a){c.logger(a).mustfix(a)}(d[31]),d[28]=c.createArray(),a[0]!==f?d[32]=(d[28].push(a[0]),d[28]):0,c.nop(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsFetchAndWriteThreadsToClientStoredProcedure",d[27],d[28],c.i64.cast([0,3]))},function(e){return a[0]!==f?c.seq([function(e){return a[0]!==f?c.sp(b("LSAppendDataTraceAddon"),a[0],c.i64.cast([0,85]),c.i64.cast([0,2]),d[31],f):c.resolve()},function(a){return c.sp(b("LSIsMobileClient")).then(function(a){return a=a,d[32]=a[0],a})},function(a){return d[32]?d[33]=!0:d[33]=!1,d[33]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[34]=c.createArray(),f!==f?d[35]=(d[34].push(f),d[34]):0,c.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[34],c.i64.cast([0,3]))):c.resolve()}]):c.resolve()},function(d){return a[0]!==f?c.nop(b("LSFlushDataTrace.nop"),a[0]):c.resolve()},function(a){return c.sp(b("LSIsMobileClient")).then(function(a){return a=a,d[29]=a[0],a})},function(a){return d[29]?d[30]=!0:d[30]=!1,d[30]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[32]=c.createArray(),f!==f?d[33]=(d[32].push(f),d[32]):0,c.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[32],c.i64.cast([0,3]))):c.resolve()}]):c.seq([function(e){return a[0]!==f?c.seq([function(d){return a[0]!==f?c.sp(b("LSAppendDataTraceAddon"),a[0],c.i64.cast([0,85]),c.i64.cast([0,2]),["[EncryptedBackups][LSEncryptedBackupsFetchAndWriteThreadsToClientStoredProcedure] ","",""].join(""),f):c.resolve()},function(a){return c.sp(b("LSIsMobileClient")).then(function(a){return a=a,d[30]=a[0],a})},function(a){return d[30]?d[31]=!0:d[31]=!1,d[31]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[32]=c.createArray(),f!==f?d[33]=(d[32].push(f),d[32]):0,c.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[32],c.i64.cast([0,3]))):c.resolve()}]):c.resolve()},function(d){return a[0]!==f?c.nop(b("LSFlushDataTrace.nop"),a[0]):c.resolve()},function(a){return c.sp(b("LSIsMobileClient")).then(function(a){return a=a,d[28]=a[0],a})},function(a){return d[28]?d[29]=!0:d[29]=!1,d[29]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[30]=c.createArray(),f!==f?d[31]=(d[30].push(f),d[30]):0,c.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[30],c.i64.cast([0,3]))):c.resolve()}])):(d[27]="missing backup_id for restore",d[27]!==f?c.seq([function(e){return d[31]=["[EncryptedBackups][LSEncryptedBackupsFetchAndWriteThreadsToClientStoredProcedure] ","",d[27]].join(""),function(a){c.logger(a).mustfix(a)}(d[31]),d[28]=c.createArray(),a[0]!==f?d[32]=(d[28].push(a[0]),d[28]):0,c.nop(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsFetchAndWriteThreadsToClientStoredProcedure",d[27],d[28],c.i64.cast([0,3]))},function(e){return a[0]!==f?c.seq([function(e){return a[0]!==f?c.sp(b("LSAppendDataTraceAddon"),a[0],c.i64.cast([0,85]),c.i64.cast([0,2]),d[31],f):c.resolve()},function(a){return c.sp(b("LSIsMobileClient")).then(function(a){return a=a,d[32]=a[0],a})},function(a){return d[32]?d[33]=!0:d[33]=!1,d[33]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[34]=c.createArray(),f!==f?d[35]=(d[34].push(f),d[34]):0,c.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[34],c.i64.cast([0,3]))):c.resolve()}]):c.resolve()},function(d){return a[0]!==f?c.nop(b("LSFlushDataTrace.nop"),a[0]):c.resolve()},function(a){return c.sp(b("LSIsMobileClient")).then(function(a){return a=a,d[29]=a[0],a})},function(a){return d[29]?d[30]=!0:d[30]=!1,d[30]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[32]=c.createArray(),f!==f?d[33]=(d[32].push(f),d[32]):0,c.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[32],c.i64.cast([0,3]))):c.resolve()}]):c.seq([function(e){return a[0]!==f?c.seq([function(d){return a[0]!==f?c.sp(b("LSAppendDataTraceAddon"),a[0],c.i64.cast([0,85]),c.i64.cast([0,2]),["[EncryptedBackups][LSEncryptedBackupsFetchAndWriteThreadsToClientStoredProcedure] ","",""].join(""),f):c.resolve()},function(a){return c.sp(b("LSIsMobileClient")).then(function(a){return a=a,d[30]=a[0],a})},function(a){return d[30]?d[31]=!0:d[31]=!1,d[31]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[32]=c.createArray(),f!==f?d[33]=(d[32].push(f),d[32]):0,c.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[32],c.i64.cast([0,3]))):c.resolve()}]):c.resolve()},function(d){return a[0]!==f?c.nop(b("LSFlushDataTrace.nop"),a[0]):c.resolve()},function(a){return c.sp(b("LSIsMobileClient")).then(function(a){return a=a,d[28]=a[0],a})},function(a){return d[28]?d[29]=!0:d[29]=!1,d[29]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[30]=c.createArray(),f!==f?d[31]=(d[30].push(f),d[30]):0,c.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[30],c.i64.cast([0,3]))):c.resolve()}]))},function(e){return c.seq([function(d){return a[0]!==f?c.sp(b("LSAppendDataTraceAddon"),a[0],c.i64.cast([0,84]),c.i64.cast([0,2]),f,f):c.resolve()},function(a){return c.sp(b("LSIsMobileClient")).then(function(a){return a=a,d[27]=a[0],a})},function(a){return d[27]?d[28]=!0:d[28]=!1,d[28]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[29]=c.createArray(),f!==f?d[30]=(d[29].push(f),d[29]):0,c.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[29],c.i64.cast([0,3]))):c.resolve()}])},function(d){return a[0]!==f?c.nop(b("LSFlushDataTrace.nop"),a[0]):c.resolve()},function(a){return c.sp(b("LSIsMobileClient")).then(function(a){return a=a,d[18]=a[0],a})},function(a){return d[18]?d[19]=!0:d[19]=!1,d[19]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[27]=c.createArray(),f!==f?d[28]=(d[27].push(f),d[27]):0,c.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[27],c.i64.cast([0,3]))):c.resolve()},function(a){return d[20]=c.i64.of_float(Date.now()),d[22]="Finishing execution. Execution time: ",d[23]=c.i64.to_string(c.i64.sub(d[20],d[0])),d[25]=" ms",d[21]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][LSEncryptedBackupsFetchAndWriteThreadsToClientStoredProcedure] ",d[21],d[22],d[21],d[23],d[21],d[25]].join("")),d[24]=",",d[26]=c.createArray(),f!==f?d[27]=(d[26].push(f),d[26]):0,c.nop(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsFetchAndWriteThreadsToClientStoredProcedure",[d[22],d[24],d[23],d[24],d[25]].join(""),d[26],c.i64.cast([0,4]))}])},function(a){return c.resolve(e)}])}c=a;f["default"]=c}),66);
__d("LSHandleWrongRecoveryCode",["LSAppendDataTraceAddon","LSFlushDataTrace.nop","LSIsMobileClient","LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1];c.n;var d=[],e=[],f;return c.seq([function(e){return c.seq([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsHandleWrongRecoveryCodeStoredProcedure] Beginning execution."),a[0]!==f?c.sp(b("LSAppendDataTraceAddon"),a[0],c.i64.cast([0,1415]),c.i64.cast([0,2]),a[1],f):c.resolve()},function(a){return c.sp(b("LSIsMobileClient")).then(function(a){return a=a,d[1]=a[0],a})},function(a){return d[1]?d[2]=!0:d[2]=!1,d[2]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[10]=c.createArray(),f!==f?d[11]=(d[10].push(f),d[10]):0,c.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[10],c.i64.cast([0,3]))):c.resolve()},function(a){return c.db.table(178).put({pk:c.i64.cast([0,1]),recoveryCodeStatus:c.i64.cast([0,3])})},function(e){return a[2]?c.seq([function(e){return a[2]?c.seq([function(d){return a[0]!==f?c.sp(b("LSAppendDataTraceAddon"),a[0],c.i64.cast([0,84]),c.i64.cast([0,2]),f,f):c.resolve()},function(a){return c.sp(b("LSIsMobileClient")).then(function(a){return a=a,d[12]=a[0],a})},function(a){return d[12]?d[13]=!0:d[13]=!1,d[13]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[14]=c.createArray(),f!==f?d[15]=(d[14].push(f),d[14]):0,c.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[14],c.i64.cast([0,3]))):c.resolve()}]):a[0]!==f?c.seq([function(d){return a[0]!==f?c.sp(b("LSAppendDataTraceAddon"),a[0],c.i64.cast([0,85]),c.i64.cast([0,2]),"The flow did not succeed",f):c.resolve()},function(a){return c.sp(b("LSIsMobileClient")).then(function(a){return a=a,d[12]=a[0],a})},function(a){return d[12]?d[13]=!0:d[13]=!1,d[13]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[14]=c.createArray(),f!==f?d[15]=(d[14].push(f),d[14]):0,c.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[14],c.i64.cast([0,3]))):c.resolve()}]):c.resolve()},function(d){return a[0]!==f?c.nop(b("LSFlushDataTrace.nop"),a[0]):c.resolve()},function(a){return c.sp(b("LSIsMobileClient")).then(function(a){return a=a,d[10]=a[0],a})},function(a){return d[10]?d[11]=!0:d[11]=!1,d[11]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[12]=c.createArray(),f!==f?d[13]=(d[12].push(f),d[12]):0,c.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[12],c.i64.cast([0,3]))):c.resolve()}]):a[1]!==f?c.seq([function(e){return d[13]=["[EncryptedBackups][LSEncryptedBackupsHandleWrongRecoveryCodeStoredProcedure] ","",a[1]].join(""),function(a){c.logger(a).mustfix(a)}(d[13]),d[10]=c.createArray(),a[0]!==f?d[14]=(d[10].push(a[0]),d[10]):0,c.nop(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsHandleWrongRecoveryCodeStoredProcedure",a[1],d[10],c.i64.cast([0,3]))},function(e){return a[0]!==f?c.seq([function(e){return a[0]!==f?c.sp(b("LSAppendDataTraceAddon"),a[0],c.i64.cast([0,85]),c.i64.cast([0,2]),d[13],f):c.resolve()},function(a){return c.sp(b("LSIsMobileClient")).then(function(a){return a=a,d[14]=a[0],a})},function(a){return d[14]?d[15]=!0:d[15]=!1,d[15]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[16]=c.createArray(),f!==f?d[17]=(d[16].push(f),d[16]):0,c.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[16],c.i64.cast([0,3]))):c.resolve()}]):c.resolve()},function(d){return a[0]!==f?c.nop(b("LSFlushDataTrace.nop"),a[0]):c.resolve()},function(a){return c.sp(b("LSIsMobileClient")).then(function(a){return a=a,d[11]=a[0],a})},function(a){return d[11]?d[12]=!0:d[12]=!1,d[12]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[14]=c.createArray(),f!==f?d[15]=(d[14].push(f),d[14]):0,c.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[14],c.i64.cast([0,3]))):c.resolve()}]):c.seq([function(e){return a[0]!==f?c.seq([function(d){return a[0]!==f?c.sp(b("LSAppendDataTraceAddon"),a[0],c.i64.cast([0,85]),c.i64.cast([0,2]),["[EncryptedBackups][LSEncryptedBackupsHandleWrongRecoveryCodeStoredProcedure] ","",""].join(""),f):c.resolve()},function(a){return c.sp(b("LSIsMobileClient")).then(function(a){return a=a,d[12]=a[0],a})},function(a){return d[12]?d[13]=!0:d[13]=!1,d[13]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[14]=c.createArray(),f!==f?d[15]=(d[14].push(f),d[14]):0,c.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[14],c.i64.cast([0,3]))):c.resolve()}]):c.resolve()},function(d){return a[0]!==f?c.nop(b("LSFlushDataTrace.nop"),a[0]):c.resolve()},function(a){return c.sp(b("LSIsMobileClient")).then(function(a){return a=a,d[10]=a[0],a})},function(a){return d[10]?d[11]=!0:d[11]=!1,d[11]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[12]=c.createArray(),f!==f?d[13]=(d[12].push(f),d[12]):0,c.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[12],c.i64.cast([0,3]))):c.resolve()}])},function(a){return d[3]=c.i64.of_float(Date.now()),d[5]="Finishing execution. Execution time: ",d[6]=c.i64.to_string(c.i64.sub(d[3],d[0])),d[8]=" ms",d[4]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][LSEncryptedBackupsHandleWrongRecoveryCodeStoredProcedure] ",d[4],d[5],d[4],d[6],d[4],d[8]].join("")),d[7]=",",d[9]=c.createArray(),f!==f?d[10]=(d[9].push(f),d[9]):0,c.nop(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsHandleWrongRecoveryCodeStoredProcedure",[d[5],d[7],d[6],d[7],d[8]].join(""),d[9],c.i64.cast([0,4]))}])},function(a){return c.resolve(e)}])}c=a;f["default"]=c}),66);
__d("LSInitializeRestore",["LSAppendDataTraceAddon","LSArrayGetObjectAt","LSCreateDataTrace","LSCreateDataTraceID.nop","LSFetchAndWriteThreadsToClient","LSGetLatestThreadIds.nop","LSIsMobileClient","LSIssueMessageRangeQueryTask","LSIssueNewTask","LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1];c.n;var d=[],e=[],f;return c.seq([function(a){return c.seq([function(a){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsInitializeRestoreStoredProcedure] Beginning execution."),c.seq([function(a){return c.nop(b("LSGetLatestThreadIds.nop"),"AdvancedCrypto",c.i64.cast([0,100]),!0).then(function(a){return a=a,d[8]=a[0],d[9]=a[1],a})},function(a){return c.fe(c.db.table(231).fetch(),function(a){return a["delete"]()})},function(a){return d[9]?d[8]!==f?(d[10]=c.i64.of_int32(d[8].length),c.i64.gt(d[10],c.i64.cast([0,0]))?c.loopAsync(d[10],function(a){return d[11]=a,c.seq([function(a){return c.ntop("Array",b("LSArrayGetObjectAt"),d[8],d[11]).then(function(a){return a=a,d[12]=a[0],d[13]=a[1],a})},function(a){return c.islc(c.ftr(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))&&c.i64.eq(a.backupTenancy,c.i64.cast([0,2]))}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(a,b){b=a.done;a=a.value;return b?d[14]=!1:(a.item,d[14]=!0)})},function(a){return d[14]?d[16]=c.i64.or_(c.i64.cast([0,73]),c.i64.cast([0,128])):d[16]=c.i64.cast([0,73]),c.nop(b("LSCreateDataTraceID.nop")).then(function(a){return a=a,d[17]=a[0],a})},function(a){return d[18]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][MEBTraceUtils] ",d[18],"EncryptedBackups MCD Trace ID",d[18],c.i64.to_string(d[16])].join("")),c.sp(b("LSCreateDataTrace"),d[17],f,f,"restore_messages",d[16])},function(a){return c.sp(b("LSIsMobileClient")).then(function(a){return a=a,d[19]=a[0],a})},function(a){return d[19]?d[20]=!0:d[20]=!1,d[20]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[26]=c.createArray(),f!==f?d[27]=(d[26].push(f),d[26]):0,c.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[26],c.i64.cast([0,3]))):c.resolve()},function(a){return d[17]!==f?c.sp(b("LSAppendDataTraceAddon"),d[17],c.i64.cast([0,2506]),c.i64.cast([0,2]),f,f):c.resolve()},function(a){return c.sp(b("LSIsMobileClient")).then(function(a){return a=a,d[21]=a[0],a})},function(a){return d[21]?d[22]=!0:d[22]=!1,d[22]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[26]=c.createArray(),f!==f?d[27]=(d[26].push(f),d[26]):0,c.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[26],c.i64.cast([0,3]))):c.resolve()},function(a){return d[23]=c.i64.of_float(Date.now()),c.db.table(231).add({threadId:d[12],lastUpdated:d[23],restoreStatus:c.i64.cast([0,1])})},function(a){return d[17]!==f?c.sp(b("LSAppendDataTraceAddon"),d[17],c.i64.cast([0,3602]),c.i64.cast([0,2]),f,f):c.resolve()},function(a){return c.sp(b("LSIsMobileClient")).then(function(a){return a=a,d[24]=a[0],a})},function(a){return d[24]?d[25]=!0:d[25]=!1,d[25]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[26]=c.createArray(),f!==f?d[27]=(d[26].push(f),d[26]):0,c.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[26],c.i64.cast([0,3]))):c.resolve()},function(a){return c.sp(b("LSIssueMessageRangeQueryTask"),d[12],c.i64.cast([0,20]),f,!1,d[17],c.i64.cast([0,0]))}])}):c.resolve()):(d[10]=new c.Map(),d[10].set("error_code",c.i64.cast([0,107])),d[10].set("error_message",""),d[10].set("stored_procedure","initializeRestore"),d[11]=new c.Map(),d[11].set("act_thread_id",""),d[11].set("source",c.i64.cast([0,21])),d[11].set("restore_operation_type",c.i64.cast([0,3])),d[12]=new c.Map(),d[12].set("restore_context",d[11]),d[12].set("failure",d[10]),d[13]=d[12].get("restore_context"),d[12],d[14]=d[13].get("act_thread_id"),d[13],d[15]=c.toJSON(d[12]),c.sp(b("LSIssueNewTask"),["encrypted_backups_restore",":",d[14]].join(""),c.i64.cast([0,50030]),d[15],f,f,c.i64.cast([0,0]),c.i64.cast([0,0]),f,f,c.i64.cast([0,0]))):(d[10]=new c.Map(),d[10].set("error_code",c.i64.cast([0,107])),d[10].set("error_message",""),d[10].set("stored_procedure","initializeRestore"),d[11]=new c.Map(),d[11].set("act_thread_id",""),d[11].set("source",c.i64.cast([0,21])),d[11].set("restore_operation_type",c.i64.cast([0,3])),d[12]=new c.Map(),d[12].set("restore_context",d[11]),d[12].set("failure",d[10]),d[13]=d[12].get("restore_context"),d[12],d[14]=d[13].get("act_thread_id"),d[13],d[15]=c.toJSON(d[12]),c.sp(b("LSIssueNewTask"),["encrypted_backups_restore",":",d[14]].join(""),c.i64.cast([0,50030]),d[15],f,f,c.i64.cast([0,0]),c.i64.cast([0,0]),f,f,c.i64.cast([0,0])))}])},function(a){return d[1]=c.i64.of_float(Date.now()),d[3]="Finishing execution. Execution time: ",d[4]=c.i64.to_string(c.i64.sub(d[1],d[0])),d[6]=" ms",d[2]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][LSEncryptedBackupsInitializeRestoreStoredProcedure] ",d[2],d[3],d[2],d[4],d[2],d[6]].join("")),d[5]=",",d[7]=c.createArray(),f!==f?d[8]=(d[7].push(f),d[7]):0,c.nop(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsInitializeRestoreStoredProcedure",[d[3],d[5],d[4],d[5],d[6]].join(""),d[7],c.i64.cast([0,4]))},function(a){return e[0]=c.i64.cast([0,0])}])},function(a){return c.resolve(e)}])}c=a;f["default"]=c}),66);
__d("MWEncryptedBackupsInitializeRestore.bs",["LSFactory","LSInitializeRestore"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return a.runInTransaction(function(a){return c("LSInitializeRestore")(c("LSFactory")(a))},"readwrite")}g.initializeRestoreStoredProcedure=a}),98);
__d("MWEncryptedBackupsInitializeRestoreDeferred.bs",["MWChatEncryptedBackupsQPLEvents","QPLUserFlow","WALogger","promiseDone","react","requireDeferred","useReStore"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Error initializing restore: ",""]);h=function(){return a};return a}var i=d("react").useCallback,j=c("requireDeferred")("MWEncryptedBackupsInitializeRestore.bs").__setRef("MWEncryptedBackupsInitializeRestoreDeferred.bs");function a(a,b){var e=c("useReStore")();return i(function(){j.onReady(function(f){c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreDeviceAuthQplEvent,"add_device_init_restore_sproc"),c("promiseDone")(f.initializeRestoreStoredProcedure(e),a,function(a){d("WALogger").ERROR(h(),a),b==null?void 0:b()})})},[e,a,b])}g.useInitRestore=a}),98);
__d("useMWEncryptedBackupsFetchBackupIds",["LSEncryptedBackupsBackupTenancy","LSFactory","LSFetchBackupIds","LSIntEnum","react","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h=d("react").useCallback;function a(){var a=c("useReStore")();return h(function(){return a.runInTransaction(function(a){return c("LSFetchBackupIds")(d("LSIntEnum").ofNumber(c("LSEncryptedBackupsBackupTenancy").PRODUCTION),void 0,c("LSFactory")(a))},"readwrite")},[a])}g["default"]=a}),98);/*FB_PKG_DELIM*/
__d("LSCreateOpenToE2EEThreadLink",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1];b.n;var c=[];return b.seq([function(c){return b.db.table(193).put({openThreadId:a[0],armadilloThreadId:a[1],showOpenMessageHistory:a[2],timestampMs:a[3]})},function(a){return b.resolve(c)}])}b=a;f["default"]=b}),66);
__d("LSSymmetricEncryptionCreateDecryptedData.bs",["CryptoLogger","EncryptedBackupsSymmetricEncryptionUtils","HChaCha20","Promise","RetUtil","SymmetricEncryptionPaddingUtils","globalCryptoSubtle"],(function(a,b,c,d,e,f,g){"use strict";var h,i=d("CryptoLogger").CryptoLogger("symmetric_encryption_create_decrypted_data");function a(a,e,f,g,j){if(j.byteLength<(d("EncryptedBackupsSymmetricEncryptionUtils").hChaCha20SubKeyNonceLengthInBytes+d("EncryptedBackupsSymmetricEncryptionUtils").aesGcmTagLengthInBytes|0)){i.mustfix("cipher text is invalid");return(h||(h=b("Promise"))).resolve(d("RetUtil").getNullableRetResult())}a=new Uint8Array(j);var k=a.slice(0,d("EncryptedBackupsSymmetricEncryptionUtils").totalNonceLengthInBytes);e=new(d("HChaCha20").HChaCha20)();var l=a.slice(d("EncryptedBackupsSymmetricEncryptionUtils").totalNonceLengthInBytes).buffer;j=e.hChaCha20Bytes(k.slice(0,d("EncryptedBackupsSymmetricEncryptionUtils").hChaCha20SubKeyNonceLengthInBytes).buffer,f);return c("globalCryptoSubtle").importKey("raw",j,"AES-GCM",!1,["decrypt"]).then(function(a){return c("globalCryptoSubtle").decrypt({additionalData:g,iv:new Uint8Array(k.slice(d("EncryptedBackupsSymmetricEncryptionUtils").hChaCha20SubKeyNonceLengthInBytes).buffer),name:"AES-GCM",tagLength:d("EncryptedBackupsSymmetricEncryptionUtils").aesGcmTagLength},a,l)}).then(function(a){a=d("SymmetricEncryptionPaddingUtils").stripPadding(a);return d("RetUtil").getNullableRetResult(a!=null?a:(i.mustfix("Failed to strip padding for symmetric decryption"),void 0))})["catch"](function(a){d("CryptoLogger").captureError(i,a).mustfix("symmetric data decryption failed");return(h||(h=b("Promise"))).resolve(d("RetUtil").getNullableRetResult())})}g.call=a}),98);
__d("LSSymmetricEncryptionCreateDecryptedString.bs",["Base64Utils","CryptoLogger","LSResult","LSSymmetricEncryptionCreateDecryptedData.bs"],(function(a,b,c,d,e,f,g){"use strict";function h(a){return c("LSResult")(a)}function a(a,b,c,e,f){var g=d("CryptoLogger").CryptoLogger("symmetric_encryption_create_decrypted_string");f=d("Base64Utils").toArrayBuffer(f);return d("LSSymmetricEncryptionCreateDecryptedData.bs").call(a,b,c,e,f).then(function(a){a=a[0];return a}).then(function(a){return a==null?h():h(new TextDecoder().decode(a))})["catch"](function(a){d("CryptoLogger").captureError(g,a).mustfix("symmetric string decryption failed");return h()})}g.call=a}),98);
__d("LSSymmetricEncryptionCreateDecryptedString.nop",["LSSymmetricEncryptionCreateDecryptedString.bs"],(function(a,b,c,d,e,f,g){"use strict";a=function(a,b,c,e,f){return d("LSSymmetricEncryptionCreateDecryptedString.bs").call(a,b,c,e,f)};g["default"]=a}),98);
__d("LSDecryptMessageForSnapshot",["LSAppendDataTraceAddon","LSArrayGetObjectAt","LSCreateDerivedKeys.nop","LSGetBlobFromString.nop","LSIsMobileClient","LSLogMebClientEvent.nop","LSSymmetricEncryptionCreateDecryptedString.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1];c.n;var d=[],e=[],f;return c.seq([function(g){return c.seq([function(e){return d[3]=a[2]==null?c.i64.cast([0,0]):a[2],d[0]=c.createArray(),d[1]=c.i64.of_int32(a[5].length),c.i64.eq(d[1],c.i64.cast([0,1]))?c.seq([function(e){return c.ntop("Array",b("LSArrayGetObjectAt"),a[5],c.i64.cast([0,0])).then(function(a){return a=a,d[4]=a[0],d[5]=a[1],a})},function(e){return d[6]=d[4].get("epoch_anon_id"),d[4],d[7]=d[4].get("epoch_root_key"),d[4],d[8]=c.createArray(),d[16]=(d[8].push(c.i64.cast([0,32])),d[8]),c.i64.ge(d[3],c.i64.cast([0,3]))?c.resolve(d[9]=f):c.seq([function(e){return c.nop(b("LSGetBlobFromString.nop"),a[1]).then(function(a){return a=a,d[16]=a[0],a})},function(a){return d[9]=d[16]}])},function(e){return c.i64.ge(d[3],c.i64.cast([0,4]))?(d[16]="_",d[10]=["message_key_in_epoch",d[16],c.blobs.to_string(d[6]),d[16],"cipher_version",d[16],c.i64.to_string(d[3]),d[16],"thread",d[16],a[1]==null?"":a[1]].join("")):(c.i64.ge(d[3],c.i64.cast([0,3]))?(d[17]="_",d[16]=["message_key_in_epoch",d[17],c.blobs.to_string(d[6]),d[17],"cipher_version",d[17],c.i64.to_string(d[3]),d[17],"thread",d[17],a[1]==null?"":a[1]].join("")):(c.i64.ge(d[3],c.i64.cast([0,2]))?(d[18]="_",d[17]=["message_key_in_epoch",d[18],c.blobs.to_string(d[6]),d[18],"cipher_version",d[18],c.i64.to_string(d[3])].join("")):d[17]=["message_key_in_epoch","_",c.blobs.to_string(d[6])].join(""),d[16]=d[17]),d[10]=d[16]),c.nop(b("LSGetBlobFromString.nop"),d[10]).then(function(a){return a=a,d[11]=a[0],a})},function(a){return c.nop(b("LSCreateDerivedKeys.nop"),d[11],d[9],d[7],d[8]).then(function(a){return a=a,d[12]=a[0],a})},function(a){return d[12]?d[13]=!1:d[13]=!0,d[13]?c.resolve(d[14]=f):c.seq([function(a){return c.ntop("Array",b("LSArrayGetObjectAt"),d[12],c.i64.cast([0,0])).then(function(a){return a=a,d[16]=a[0],d[17]=a[1],a})},function(a){return d[14]=d[16]}])},function(e){return c.blobs.neq(d[14],f)?c.seq([function(e){return c.nop(b("LSSymmetricEncryptionCreateDecryptedString.nop"),d[14],c.blobs.of_string(["message_thread","_",a[1]].join("")),a[0]).then(function(a){return a=a,d[16]=a[0],a})},function(a){return d[16]!==f?c.resolve(d[17]=d[16]):c.seq([function(a){return d[18]=["Failed to decrypt message. Epoch Anon ID: ",c.blobs.to_string(d[6]),", Encryption Version: ",c.i64.to_string(d[3])].join(""),function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsDecryptMessageForSnapshotStoredProcedure] ","",d[18]].join("")),d[19]=c.createArray(),f!==f?d[20]=(d[19].push(f),d[19]):0,c.nop(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsDecryptMessageForSnapshotStoredProcedure",[d[18]].join(""),d[19],c.i64.cast([0,3]))},function(a){return d[17]=f}])},function(a){return d[15]=d[17]}]):c.seq([function(e){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsDecryptMessageForSnapshotStoredProcedure] Decryption message key is null"),a[4]!==f?c.seq([function(d){return a[4]!==f?c.sp(b("LSAppendDataTraceAddon"),a[4],c.i64.cast([0,85]),c.i64.cast([0,2]),"[EncryptedBackups][LSEncryptedBackupsDecryptMessageForSnapshotStoredProcedure] Decryption message key is null",f):c.resolve()},function(a){return c.sp(b("LSIsMobileClient")).then(function(a){return a=a,d[17]=a[0],a})},function(a){return d[17]?d[18]=!0:d[18]=!1,d[18]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[19]=c.createArray(),f!==f?d[20]=(d[19].push(f),d[19]):0,c.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[19],c.i64.cast([0,3]))):c.resolve()}]):c.resolve()},function(e){return d[16]=c.createArray(),a[4]!==f?d[17]=(d[16].push(a[4]),d[16]):0,c.nop(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsDecryptMessageForSnapshotStoredProcedure","Decryption message key is null",d[16],c.i64.cast([0,3]))},function(a){return d[15]=f}])},function(a){return d[2]=d[15]}]):c.seq([function(e){return d[4]=c.i64.of_int32(a[5].length),c.i64.eq(d[4],c.i64.cast([0,0]))?(d[5]=" ",d[6]=["Did not find epoch with anon id",d[5],c.blobs.to_string(a[3]),d[5],"cannot decrypt message"].join(""),function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsDecryptMessageForSnapshotStoredProcedure] ","",d[6]].join("")),d[7]=c.createArray(),f!==f?d[8]=(d[7].push(f),d[7]):0,c.nop(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsDecryptMessageForSnapshotStoredProcedure",[d[6]].join(""),d[7],c.i64.cast([0,3]))):(d[5]=" ",d[6]=["Found more than one epoch with anon id",d[5],c.blobs.to_string(a[3]),d[5],"cannot decrypt message"].join(""),function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsDecryptMessageForSnapshotStoredProcedure] ","",d[6]].join("")),d[7]=c.createArray(),f!==f?d[8]=(d[7].push(f),d[7]):0,c.nop(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsDecryptMessageForSnapshotStoredProcedure",[d[6]].join(""),d[7],c.i64.cast([0,3])))},function(a){return d[2]=f}])},function(e){return d[2]!==f?c.i64.eq(d[3],c.i64.cast([0,0]))?c.seq([function(d){return a[4]!==f?c.sp(b("LSAppendDataTraceAddon"),a[4],c.i64.cast([0,1499]),c.i64.cast([0,2]),f,["50014"].join("")):c.resolve()},function(a){return c.sp(b("LSIsMobileClient")).then(function(a){return a=a,d[4]=a[0],a})},function(a){return d[4]?d[5]=!0:d[5]=!1,d[5]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[6]=c.createArray(),f!==f?d[7]=(d[6].push(f),d[6]):0,c.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[6],c.i64.cast([0,3]))):c.resolve()}]):c.i64.eq(d[3],c.i64.cast([0,2]))?c.seq([function(d){return a[4]!==f?c.sp(b("LSAppendDataTraceAddon"),a[4],c.i64.cast([0,1499]),c.i64.cast([0,2]),f,["50015"].join("")):c.resolve()},function(a){return c.sp(b("LSIsMobileClient")).then(function(a){return a=a,d[4]=a[0],a})},function(a){return d[4]?d[5]=!0:d[5]=!1,d[5]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[6]=c.createArray(),f!==f?d[7]=(d[6].push(f),d[6]):0,c.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[6],c.i64.cast([0,3]))):c.resolve()}]):c.i64.eq(d[3],c.i64.cast([0,3]))?c.seq([function(d){return a[4]!==f?c.sp(b("LSAppendDataTraceAddon"),a[4],c.i64.cast([0,1499]),c.i64.cast([0,2]),f,["50016"].join("")):c.resolve()},function(a){return c.sp(b("LSIsMobileClient")).then(function(a){return a=a,d[4]=a[0],a})},function(a){return d[4]?d[5]=!0:d[5]=!1,d[5]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[6]=c.createArray(),f!==f?d[7]=(d[6].push(f),d[6]):0,c.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[6],c.i64.cast([0,3]))):c.resolve()}]):c.i64.eq(d[3],c.i64.cast([0,4]))?c.seq([function(d){return a[4]!==f?c.sp(b("LSAppendDataTraceAddon"),a[4],c.i64.cast([0,1499]),c.i64.cast([0,2]),f,["50017"].join("")):c.resolve()},function(a){return c.sp(b("LSIsMobileClient")).then(function(a){return a=a,d[4]=a[0],a})},function(a){return d[4]?d[5]=!0:d[5]=!1,d[5]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[6]=c.createArray(),f!==f?d[7]=(d[6].push(f),d[6]):0,c.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[6],c.i64.cast([0,3]))):c.resolve()}]):c.seq([function(d){return a[4]!==f?c.sp(b("LSAppendDataTraceAddon"),a[4],c.i64.cast([0,1499]),c.i64.cast([0,2]),f,f):c.resolve()},function(a){return c.sp(b("LSIsMobileClient")).then(function(a){return a=a,d[4]=a[0],a})},function(a){return d[4]?d[5]=!0:d[5]=!1,d[5]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[6]=c.createArray(),f!==f?d[7]=(d[6].push(f),d[6]):0,c.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[6],c.i64.cast([0,3]))):c.resolve()}]):c.resolve()},function(a){return e[0]=d[2]}])},function(a){return c.resolve(e)}])}c=a;f["default"]=c}),66);
__d("MAWRestoreMessagesFromEncryptedBackupsDeferred",["I64","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h=c("requireDeferred")("MAWRestoreMessagesFromEncryptedBackupsNOP").__setRef("MAWRestoreMessagesFromEncryptedBackupsDeferred");function a(a,b,c,e,f,g,i,j,k,l,m,n){return h.load().then(function(h){return h.call(a,b,c,e,f,g,i,j,k,l,m,n!=null?d("I64").to_float(n):void 0)})}g.call=a}),98);
__d("LSRestoreMessagesV2.bs",["MAWRestoreMessagesFromEncryptedBackupsDeferred","Promise","WALogger"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["LSRestoreMessagesV2 error: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] threadId: + ",", + messages count: + ",", + hasMoreBefore: +",",\n   messageBeforeTimestamp: ",", hasMoreAfter: ",", messageAfterTimestamp: ",",\n   isPointQuery: ",", traceId: ",", startSortKey: ",""]);j=function(){return a};return a}function a(a,c,e,f,g,k,l,m,n,o,p,q,r,s,t,u){d("WALogger").LOG(j(),f,g.length,k,l,m,n,o,p,t);return d("MAWRestoreMessagesFromEncryptedBackupsDeferred").call(a,e,f,g,k,l,m,n,o,p,t)["catch"](function(a){d("WALogger").ERROR(i(),a);return(h||(h=b("Promise"))).resolve([[],[],!0])})}c=a;g.call=c}),98);
__d("LSRestoreMessagesV2.nop",["LSRestoreMessagesV2.bs"],(function(a,b,c,d,e,f,g){"use strict";a=function(a,b,c,e,f,g,h,i,j,k,l,m,n,o,p,q){return d("LSRestoreMessagesV2.bs").call(a,b,c,e,f,g,h,i,j,k,l,m,n,o,p,q)};g["default"]=a}),98);
__d("LSDecryptAndWriteMessagesToClientForSnapshot",["LSAppendDataTraceAddon","LSArrayGetObjectAt","LSCreateDataTrace","LSCreateDataTraceID.nop","LSDecryptMessageForSnapshot","LSFlushDataTrace.nop","LSIsEncryptionVersionSecure","LSIsMobileClient","LSIssuePointQueryRestoreTask","LSLogMebClientEvent.nop","LSRestoreMessagesV2.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1];c.n;var d=[],e=[],f;return c.seq([function(e){return c.seq([function(a){return c.islc(c.ftr(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(a,e){var g=a.done;a=a.value;return g?(g=[f,f,f,f,f,c.i64.cast([0,1]),f,f,f,f,f,f,f,c.i64.cast([0,20])],d[0]=g[0],d[1]=g[1],d[2]=g[2],d[3]=g[3],d[4]=g[4],d[5]=g[5],d[6]=g[6],d[7]=g[7],d[8]=g[8],d[9]=g[9],d[10]=g[10],d[11]=g[11],d[12]=g[12],d[13]=g[13],g):(e=a.item,c.seq([function(a){return d[24]=e.backupTenancy,d[23]=e.encryptionVersion,c.i64.neq(f,f)?c.resolve(d[20]=f):c.seq([function(a){return d[25]=c.createArray(),c.sp(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[26]=a[0],a})},function(a){return d[26]?d[35]=(d[25].push(c.i64.cast([0,0])),d[25]):0,c.sp(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[27]=a[0],a})},function(a){return d[27]?d[35]=(d[25].push(c.i64.cast([0,2])),d[25]):0,c.sp(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[28]=a[0],a})},function(a){return d[28]?d[35]=(d[25].push(c.i64.cast([0,3])),d[25]):0,c.sp(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[29]=a[0],a})},function(a){return d[29]?d[35]=(d[25].push(c.i64.cast([0,4])),d[25]):0,d[30]=c.createArray(),d[31]=c.i64.of_int32(d[25].length),c.i64.gt(d[31],c.i64.cast([0,0]))?c.loopAsync(d[31],function(a){return d[35]=a,c.seq([function(a){return c.ntop("Array",b("LSArrayGetObjectAt"),d[25],d[35]).then(function(a){return a=a,d[36]=a[0],d[37]=a[1],a})},function(a){return d[38]=(d[30].push(d[36]),d[30])}])}):c.resolve()},function(a){return c.seq([function(a){return d[35]=c.createArray(),d[36]=c.i64.of_int32(d[30].length),c.i64.gt(d[36],c.i64.cast([0,0]))?c.loopAsync(d[36],function(a){return d[38]=a,c.seq([function(a){return c.ntop("Array",b("LSArrayGetObjectAt"),d[30],d[38]).then(function(a){return a=a,d[39]=a[0],d[40]=a[1],a})},function(a){return d[41]=(d[35].push(c.i64.to_string(d[39])),d[35])}])}):c.resolve()},function(a){return d[37]=d[35].join(","),d[32]=d[37]}])},function(a){return d[30].some(function(a){return c.i64.eq(d[23],a)})?d[33]=d[23]:d[33]=f,c.i64.neq(d[33],f)?d[34]=d[33]:d[34]=f,d[20]=d[34]}])},function(a){return c.i64.neq(d[20],f)?d[21]=d[20]:d[21]=c.i64.cast([0,0]),c.i64.neq(d[24],f)?d[22]=d[24]:d[22]=c.i64.cast([0,1]),a=[e.backupId,e.deviceId,e.mailboxRootKeyBlob,e.ocmfClientStateBlob,d[21],d[22],e.epochAuthPublicKeyBlob,e.epochAuthPrivateKeyBlob,e.devicePublicKeyBlob,e.devicePrivateKeyBlob,e.epochStoragePublicKeyBlob,e.epochStoragePrivateKeyBlob,e.obliviousValidationTokenBlob,e.authorityLevel],d[0]=a[0],d[1]=a[1],d[2]=a[2],d[3]=a[3],d[4]=a[4],d[5]=a[5],d[6]=a[6],d[7]=a[7],d[8]=a[8],d[9]=a[9],d[10]=a[10],d[11]=a[11],d[12]=a[12],d[13]=a[13],a}]))})},function(a){return c.nop(b("LSCreateDataTraceID.nop")).then(function(a){return a=a,d[15]=a[0],a})},function(a){return d[16]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][MEBTraceUtils] ",d[16],"EncryptedBackups MCD Trace ID",d[16],c.i64.to_string(c.i64.cast([0,190]))].join("")),c.sp(b("LSCreateDataTrace"),d[15],f,f,"deanon_restore",c.i64.cast([0,190]))},function(a){return c.sp(b("LSIsMobileClient")).then(function(a){return a=a,d[17]=a[0],a})},function(a){return d[17]?d[18]=!0:d[18]=!1,d[18]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[20]=c.createArray(),f!==f?d[21]=(d[20].push(f),d[20]):0,c.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[20],c.i64.cast([0,3]))):c.resolve()},function(a){return c.i64.neq(f,f)?c.seq([function(a){return c.ftr(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))}).next().then(function(a,b){var e=a.done;a=a.value;return e?d[20]=!1:(b=a.item,d[23]=b.deviceId,c.i64.neq(d[23],f)?d[22]=c.i64.neq(d[23],f):d[22]=!1,d[20]=d[22])})},function(a){return d[19]=d[20]}]):c.resolve(d[19]=!1)},function(e){return d[19]?(d[20]="Skipping snapshot restore due to device ID mismatch.",function(a){c.logger(a).warn(a)}(["[EncryptedBackups][LSEncryptedBackupsDecryptAndWriteMessagesToClientForSnapshotStoredProcedure] ","",d[20]].join("")),d[21]=c.createArray(),f!==f?d[22]=(d[21].push(f),d[21]):0,c.nop(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsDecryptAndWriteMessagesToClientForSnapshotStoredProcedure",[d[20]].join(""),d[21],c.i64.cast([0,2]))):c.i64.neq(d[0],f)?c.seq([function(e){return d[20]=c.createArray(),d[21]=new c.Map(),d[22]=c.i64.of_int32(a[0].length),c.i64.gt(d[22],c.i64.cast([0,0]))?c.loopAsync(d[22],function(e){return d[23]=e,c.seq([function(e){return c.ntop("Array",b("LSArrayGetObjectAt"),a[0],d[23]).then(function(a){return a=a,d[24]=a[0],d[25]=a[1],a})},function(a){return d[26]=d[24].get("epoch_anon_id"),d[24],d[27]=d[21].get(c.blobs.to_string(d[26])),d[21],d[27]!==f?c.resolve(d[28]=d[27]):c.seq([function(a){return d[33]=c.createArray(),c.fe(c.ftr(c.db.table(169).fetch([[[d[0]]],"fk_secure_encrypted_backups_client_state"]),function(a){return c.i64.eq(a.backupId,d[0])&&c.blobs.eq(a.epochAnonIdBlob,d[26])&&c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))}),function(a){a=a.item;return d[34]=new c.Map(),d[34].set("epoch_root_key",a.epochRootKeyBlob),d[34].set("epoch_anon_id",a.epochAnonIdBlob),d[35]=(d[33].push(d[34]),d[33])})},function(a){return d[21].set(c.blobs.to_string(d[26]),d[33]),d[28]=d[33]}])},function(a){return d[29]=d[24].get("value"),d[24],d[30]=d[24].get("thread_id"),d[24],d[31]=d[24].get("encryption_version"),d[24],c.sp(b("LSDecryptMessageForSnapshot"),d[29],d[30],d[31]==null?c.i64.cast([0,0]):d[31],d[26],d[15],d[28]).then(function(a){return a=a,d[32]=a[0],a})},function(a){return d[32]!==f?c.resolve(d[33]=(d[20].push(d[32]),d[20])):c.seq([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsDecryptAndWriteMessagesToClientForSnapshotStoredProcedure] Message decryption failed"),d[15]!==f?c.seq([function(a){return d[15]!==f?c.sp(b("LSAppendDataTraceAddon"),d[15],c.i64.cast([0,85]),c.i64.cast([0,2]),"[EncryptedBackups][LSEncryptedBackupsDecryptAndWriteMessagesToClientForSnapshotStoredProcedure] Message decryption failed",f):c.resolve()},function(a){return c.sp(b("LSIsMobileClient")).then(function(a){return a=a,d[34]=a[0],a})},function(a){return d[34]?d[35]=!0:d[35]=!1,d[35]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[36]=c.createArray(),f!==f?d[37]=(d[36].push(f),d[36]):0,c.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[36],c.i64.cast([0,3]))):c.resolve()}]):c.resolve()},function(a){return d[33]=c.createArray(),d[15]!==f?d[34]=(d[33].push(d[15]),d[33]):0,c.nop(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsDecryptAndWriteMessagesToClientForSnapshotStoredProcedure","Message decryption failed",d[33],c.i64.cast([0,3]))}])}])}):c.resolve()},function(e){return c.i64.eq(d[5],c.i64.cast([0,2]))?(d[23]=c.i64.of_int32(d[20].length),c.i64.gt(d[23],c.i64.cast([0,0]))?c.loopAsync(d[23],function(a){return d[24]=a,c.seq([function(a){return c.ntop("Array",b("LSArrayGetObjectAt"),d[20],d[24]).then(function(a){return a=a,d[25]=a[0],d[26]=a[1],a})},function(a){return d[25]!=='Send-Error: none\nMessage-ID: ThisIsAStaticMessageIdForTesting\nThread-ID: ThisIsAStaticThreadIdForTesting\nSort-Order: 0000000000000\nDisplay-Timestamp: 0000000000000\nAuthoritative-Timestamp: 0000000000000\nFrom: "TestUser1" <00000000000000@Test>\nText: Test Message\nText-Size: none\nMessage-Content-Type: text\nEcho-Doc-Version: 1\nX-Offline-Threading-ID: 0000000000000000000\nX-Message-Placeholder-Type: none\nX-Thread-ID: 00000000000000\nSend-Error: none\n00000000000000@Test-Receipt-Status: delivered\nIs-Tombstoned: 0\nExpire-Timestamp:\nDelete-Timestamp:\n00000000000000@Test-Receipt-Status: read\n00000000000000@Test-Receipt-Timestamp: 0000000000000\nSend-Error: none\n00000000000000@Test-Receipt-Status: read\n00000000000000@Test-Receipt-Timestamp: 0000000000000'?(d[27]="Shadow test paylaod mismatch",d[27]!==f?c.seq([function(a){return d[31]=["[EncryptedBackups][LSEncryptedBackupsDecryptAndWriteMessagesToClientForSnapshotStoredProcedure] ","",d[27]].join(""),function(a){c.logger(a).mustfix(a)}(d[31]),d[28]=c.createArray(),f!==f?d[32]=(d[28].push(f),d[28]):0,c.nop(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsDecryptAndWriteMessagesToClientForSnapshotStoredProcedure",d[27],d[28],c.i64.cast([0,3]))},function(a){return f!==f?c.seq([function(a){return f!==f?c.sp(b("LSAppendDataTraceAddon"),f,c.i64.cast([0,85]),c.i64.cast([0,2]),d[31],f):c.resolve()},function(a){return c.sp(b("LSIsMobileClient")).then(function(a){return a=a,d[32]=a[0],a})},function(a){return d[32]?d[33]=!0:d[33]=!1,d[33]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[34]=c.createArray(),f!==f?d[35]=(d[34].push(f),d[34]):0,c.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[34],c.i64.cast([0,3]))):c.resolve()}]):c.resolve()},function(a){return f!==f?c.nop(b("LSFlushDataTrace.nop"),f):c.resolve()},function(a){return c.sp(b("LSIsMobileClient")).then(function(a){return a=a,d[29]=a[0],a})},function(a){return d[29]?d[30]=!0:d[30]=!1,d[30]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[32]=c.createArray(),f!==f?d[33]=(d[32].push(f),d[32]):0,c.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[32],c.i64.cast([0,3]))):c.resolve()}]):c.seq([function(a){return f!==f?c.seq([function(a){return f!==f?c.sp(b("LSAppendDataTraceAddon"),f,c.i64.cast([0,85]),c.i64.cast([0,2]),["[EncryptedBackups][LSEncryptedBackupsDecryptAndWriteMessagesToClientForSnapshotStoredProcedure] ","",""].join(""),f):c.resolve()},function(a){return c.sp(b("LSIsMobileClient")).then(function(a){return a=a,d[30]=a[0],a})},function(a){return d[30]?d[31]=!0:d[31]=!1,d[31]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[32]=c.createArray(),f!==f?d[33]=(d[32].push(f),d[32]):0,c.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[32],c.i64.cast([0,3]))):c.resolve()}]):c.resolve()},function(a){return f!==f?c.nop(b("LSFlushDataTrace.nop"),f):c.resolve()},function(a){return c.sp(b("LSIsMobileClient")).then(function(a){return a=a,d[28]=a[0],a})},function(a){return d[28]?d[29]=!0:d[29]=!1,d[29]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[30]=c.createArray(),f!==f?d[31]=(d[30].push(f),d[30]):0,c.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[30],c.i64.cast([0,3]))):c.resolve()}])):c.resolve()}])}):c.resolve()):c.seq([function(a){return d[23]=c.createArray(),c.sp(b("LSIsMobileClient")).then(function(a){return a=a,d[24]=a[0],a})},function(e){return d[24]?d[25]=!0:d[25]=!1,d[25]?d[26]=d[15]:d[26]=f,c.nop(b("LSRestoreMessagesV2.nop"),"AdvancedCrypto",a[1],d[20],!1,f,!1,f,!1,d[15],d[23],c.i64.cast([0,20]),c.i64.cast([0,0]),f,!1).then(function(a){return a=a,d[27]=a[0],d[28]=a[1],d[29]=a[2],a})},function(e){return d[29]!==f?d[30]=d[29]:d[30]=!0,d[30]?c.seq([function(e){return d[28]?d[31]=!1:d[31]=!0,d[31]?c.resolve():(d[27]?d[34]=!1:d[34]=!0,d[34]?c.resolve():(d[35]=c.i64.of_int32(d[28].length),d[36]=c.i64.of_int32(d[27].length),c.i64.eq(d[35],d[36])?(d[37]=c.i64.cast([0,0]),d[38]=c.i64.of_int32(d[28].length),c.i64.gt(d[38],c.i64.cast([0,0]))?c.loopAsync(d[38],function(e){return d[39]=e,c.seq([function(a){return c.ntop("Array",b("LSArrayGetObjectAt"),d[28],d[39]).then(function(a){return a=a,d[40]=a[0],d[41]=a[1],a})},function(a){return c.ntop("Array",b("LSArrayGetObjectAt"),d[27],d[37]).then(function(a){return a=a,d[42]=a[0],d[43]=a[1],a})},function(e){return c.sp(b("LSIssuePointQueryRestoreTask"),a[1],d[42],d[40],d[15],c.i64.cast([0,35])).then(function(a){return a=a,d[44]=a[0],a})},function(a){return d[37]=c.i64.add(d[37],c.i64.cast([0,1]))}])}):c.resolve()):c.seq([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsDecryptAndWriteMessagesToClientForSnapshotStoredProcedure] Number of items in message_ids and sort_keys vecs do not match"),d[15]!==f?c.seq([function(a){return d[15]!==f?c.sp(b("LSAppendDataTraceAddon"),d[15],c.i64.cast([0,85]),c.i64.cast([0,2]),"[EncryptedBackups][LSEncryptedBackupsDecryptAndWriteMessagesToClientForSnapshotStoredProcedure] Number of items in message_ids and sort_keys vecs do not match",f):c.resolve()},function(a){return c.sp(b("LSIsMobileClient")).then(function(a){return a=a,d[38]=a[0],a})},function(a){return d[38]?d[39]=!0:d[39]=!1,d[39]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[40]=c.createArray(),f!==f?d[41]=(d[40].push(f),d[40]):0,c.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[40],c.i64.cast([0,3]))):c.resolve()}]):c.resolve()},function(a){return d[37]=c.createArray(),d[15]!==f?d[38]=(d[37].push(d[15]),d[37]):0,c.nop(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsDecryptAndWriteMessagesToClientForSnapshotStoredProcedure","Number of items in message_ids and sort_keys vecs do not match",d[37],c.i64.cast([0,3]))}])))},function(a){return c.sp(b("LSIsMobileClient")).then(function(a){return a=a,d[32]=a[0],a})},function(a){return d[32]?d[33]=!0:d[33]=!1,d[33]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[34]=c.createArray(),f!==f?d[35]=(d[34].push(f),d[34]):0,c.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[34],c.i64.cast([0,3]))):c.resolve()}]):(d[31]="Failed to restore messages",d[31]!==f?c.seq([function(a){return d[35]=["[EncryptedBackups][LSEncryptedBackupsDecryptAndWriteMessagesToClientForSnapshotStoredProcedure] ","",d[31]].join(""),function(a){c.logger(a).mustfix(a)}(d[35]),d[32]=c.createArray(),d[15]!==f?d[36]=(d[32].push(d[15]),d[32]):0,c.nop(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsDecryptAndWriteMessagesToClientForSnapshotStoredProcedure",d[31],d[32],c.i64.cast([0,3]))},function(a){return d[15]!==f?c.seq([function(a){return d[15]!==f?c.sp(b("LSAppendDataTraceAddon"),d[15],c.i64.cast([0,85]),c.i64.cast([0,2]),d[35],f):c.resolve()},function(a){return c.sp(b("LSIsMobileClient")).then(function(a){return a=a,d[36]=a[0],a})},function(a){return d[36]?d[37]=!0:d[37]=!1,d[37]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[38]=c.createArray(),f!==f?d[39]=(d[38].push(f),d[38]):0,c.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[38],c.i64.cast([0,3]))):c.resolve()}]):c.resolve()},function(a){return d[15]!==f?c.nop(b("LSFlushDataTrace.nop"),d[15]):c.resolve()},function(a){return c.sp(b("LSIsMobileClient")).then(function(a){return a=a,d[33]=a[0],a})},function(a){return d[33]?d[34]=!0:d[34]=!1,d[34]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[36]=c.createArray(),f!==f?d[37]=(d[36].push(f),d[36]):0,c.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[36],c.i64.cast([0,3]))):c.resolve()}]):c.seq([function(a){return d[15]!==f?c.seq([function(a){return d[15]!==f?c.sp(b("LSAppendDataTraceAddon"),d[15],c.i64.cast([0,85]),c.i64.cast([0,2]),["[EncryptedBackups][LSEncryptedBackupsDecryptAndWriteMessagesToClientForSnapshotStoredProcedure] ","",""].join(""),f):c.resolve()},function(a){return c.sp(b("LSIsMobileClient")).then(function(a){return a=a,d[34]=a[0],a})},function(a){return d[34]?d[35]=!0:d[35]=!1,d[35]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[36]=c.createArray(),f!==f?d[37]=(d[36].push(f),d[36]):0,c.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[36],c.i64.cast([0,3]))):c.resolve()}]):c.resolve()},function(a){return d[15]!==f?c.nop(b("LSFlushDataTrace.nop"),d[15]):c.resolve()},function(a){return c.sp(b("LSIsMobileClient")).then(function(a){return a=a,d[32]=a[0],a})},function(a){return d[32]?d[33]=!0:d[33]=!1,d[33]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[34]=c.createArray(),f!==f?d[35]=(d[34].push(f),d[34]):0,c.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[34],c.i64.cast([0,3]))):c.resolve()}]))}])}]):c.resolve(function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsDecryptAndWriteMessagesToClientForSnapshotStoredProcedure] backup_id is null"))}])},function(a){return c.resolve(e)}])}c=a;f["default"]=c}),66);
__d("LSMoveThreadToE2EECutoverFolder",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1];b.n;var c=[];return b.seq([function(c){return b.db.table(9).fetch([[[a[0]]]]).next().then(function(c,d){d=c.done;c=c.value;return d?0:(c.item,b.fe(b.db.table(9).fetch([[[a[0]]]]),function(a){var c=a.update;a.item;return c({folderName:"e2ee_cutover",parentThreadKey:b.i64.cast([-1,4294967279])})}))})},function(a){return b.resolve(c)}])}b=a;f["default"]=b}),66);/*FB_PKG_DELIM*/
__d("LSCreateAuthKeyPair.nop",["CryptoLogger","Promise","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h,i=c("requireDeferred")("X25519").__setRef("LSCreateAuthKeyPair.nop");a=function(a,c){return i.load().then(function(a){a=a.generateKeys(a.KeyPurpose.Encryption);var c=a.pk;a=a.sk;return(h||(h=b("Promise"))).resolve([a.buffer,c.buffer])})["catch"](function(a){d("CryptoLogger").captureError(d("CryptoLogger").CryptoLogger("create_auth_key_pair"),a).mustfix("failed to generate an auth key pair");throw a})};g["default"]=a}),98);
__d("LSCreateEncryptionKeyPair.bs",["CryptoLogger","Promise","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h,i=c("requireDeferred")("X25519").__setRef("LSCreateEncryptionKeyPair.bs");function a(a,c){return i.load().then(function(a){a=a.generateKeys(a.KeyPurpose.Encryption);return(h||(h=b("Promise"))).resolve([a.sk.buffer,a.pk.buffer])})["catch"](function(a){var b=d("CryptoLogger").CryptoLogger("create_encryption_key_pair");d("CryptoLogger").captureError(b,a).mustfix("failed to generate an encryption key pair");throw a})}g.call=a}),98);
__d("LSCreateEncryptionKeyPair.nop",["LSCreateEncryptionKeyPair.bs"],(function(a,b,c,d,e,f,g){"use strict";a=function(a,b){return d("LSCreateEncryptionKeyPair.bs").call(a,b)};g["default"]=a}),98);
__d("LSCreateSignatureKeyPair.bs",["CryptoLogger","Promise","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h,i=c("requireDeferred")("X25519").__setRef("LSCreateSignatureKeyPair.bs");function a(a,c){return i.load().then(function(a){a=a.generateKeys(a.KeyPurpose.Signing);return(h||(h=b("Promise"))).resolve([a.sk.buffer,a.pk.buffer])})["catch"](function(a){var b=d("CryptoLogger").CryptoLogger("create_signature_key_pair");d("CryptoLogger").captureError(b,a).mustfix("Failed to create signing key pair keys");throw a})}g.call=a}),98);
__d("LSCreateSignatureKeyPair.nop",["LSCreateSignatureKeyPair.bs"],(function(a,b,c,d,e,f,g){"use strict";a=function(a,b){return d("LSCreateSignatureKeyPair.bs").call(a,b)};g["default"]=a}),98);
__d("LSCreateSignature_v2.bs",["CryptoLogger","LSResult","Promise","UInt8Array","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h,i=c("requireDeferred")("X25519").__setRef("LSCreateSignature_v2.bs");function j(a){return c("LSResult")(a)}function k(a,b){return d("UInt8Array").concatBytes([b,a].map(function(a){return new Uint8Array(a)}))}function a(a,c,e,f,g){var l=d("CryptoLogger").CryptoLogger("create_signature_v2");a=f.byteLength;if(a!==1){l.mustfix("Bad aad for signing, should be 1 byte");return(h||(h=b("Promise"))).resolve(j(void 0))}var m=k(g,f);return i.load().then(function(a){var c=a.secretKeyFromBytes(new Uint8Array(e),a.KeyPurpose.Signing);if(c!=null)return a.sign(c,m).then(function(a){return(h||(h=b("Promise"))).resolve(j(a.buffer))});else{l.mustfix("No Signature Private key");return(h||(h=b("Promise"))).resolve(j(void 0))}})}g.call=a}),98);
__d("LSCreateSignature_v2.nop",["LSCreateSignature_v2.bs"],(function(a,b,c,d,e,f,g){"use strict";a=function(a,b,c,e,f){return d("LSCreateSignature_v2.bs").call(a,b,c,e,f)};g["default"]=a}),98);
__d("LSGenerateLocalKeys",["LSArrayGetObjectAt","LSCreateAuthKeyPair.nop","LSCreateEncryptionKeyPair.nop","LSCreateSignatureKeyPair.nop","LSCreateSignature_v2.nop","LSIsEncryptionVersionSecure","LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1];c.n;var d=[],e=[],f;return c.seq([function(g){return c.seq([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][generateLocalKeys] Beginning execution."),d[1]=c.i64.of_float(Date.now()),a[0]?c.seq([function(a){return c.islc(c.ftr(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))||!0}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(a,e){var h=a.done;a=a.value;return h?c.seq([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsGenerateLocalKeysStoredProcedure] Fetching keys locally failed. Reason: 1"),d[26]=c.createArray(),f!==f?d[27]=(d[26].push(f),d[26]):0,c.nop(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGenerateLocalKeysStoredProcedure","Fetching keys locally failed. Reason: 1",d[26],c.i64.cast([0,3]))},function(a){return a=[!1,c.blob("ZGV2aWNlX3B1YmxpY19rZXk="),c.blob("ZGV2aWNlX3ByaXZhdGVfa2V5"),c.blob("ZXBvY2hfc3RvcmFnZV9wdWJsaWNfa2V5"),c.blob("ZXBvY2hfc3RvcmFnZV9wcml2YXRlX2tleQ=="),c.blob("ZXBvY2hfYXV0aF9wdWJsaWNfa2V5"),c.blob("ZXBvY2hfYXV0aF9wcml2YXRlX2tleQ==")],d[18]=a[0],d[19]=a[1],d[20]=a[2],d[21]=a[3],d[22]=a[4],d[23]=a[5],d[24]=a[6],a}]):(e=a.item,c.seq([function(a){return d[37]=e.backupTenancy,d[36]=e.encryptionVersion,c.i64.neq(f,f)?c.resolve(d[26]=f):c.seq([function(a){return d[38]=c.createArray(),c.sp(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[39]=a[0],a})},function(a){return d[39]?d[48]=(d[38].push(c.i64.cast([0,0])),d[38]):0,c.sp(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[40]=a[0],a})},function(a){return d[40]?d[48]=(d[38].push(c.i64.cast([0,2])),d[38]):0,c.sp(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[41]=a[0],a})},function(a){return d[41]?d[48]=(d[38].push(c.i64.cast([0,3])),d[38]):0,c.sp(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[42]=a[0],a})},function(a){return d[42]?d[48]=(d[38].push(c.i64.cast([0,4])),d[38]):0,d[43]=c.createArray(),d[44]=c.i64.of_int32(d[38].length),c.i64.gt(d[44],c.i64.cast([0,0]))?c.loopAsync(d[44],function(a){return d[48]=a,c.seq([function(a){return c.ntop("Array",b("LSArrayGetObjectAt"),d[38],d[48]).then(function(a){return a=a,d[49]=a[0],d[50]=a[1],a})},function(a){return d[51]=(d[43].push(d[49]),d[43])}])}):c.resolve()},function(a){return c.seq([function(a){return d[48]=c.createArray(),d[49]=c.i64.of_int32(d[43].length),c.i64.gt(d[49],c.i64.cast([0,0]))?c.loopAsync(d[49],function(a){return d[51]=a,c.seq([function(a){return c.ntop("Array",b("LSArrayGetObjectAt"),d[43],d[51]).then(function(a){return a=a,d[52]=a[0],d[53]=a[1],a})},function(a){return d[54]=(d[48].push(c.i64.to_string(d[52])),d[48])}])}):c.resolve()},function(a){return d[50]=d[48].join(","),d[45]=d[50]}])},function(a){return d[43].some(function(a){return c.i64.eq(d[36],a)})?d[46]=d[36]:d[46]=f,c.i64.neq(d[46],f)?d[47]=d[46]:d[47]=f,d[26]=d[47]}])},function(a){return c.i64.neq(d[26],f)?d[27]=d[26]:d[27]=c.i64.cast([0,0]),c.i64.neq(d[37],f)?d[28]=d[37]:d[28]=c.i64.cast([0,1]),c.i64.neq(e.deviceId,f)?c.resolve((a=[!0,e.devicePublicKeyBlob,e.devicePrivateKeyBlob,e.epochStoragePublicKeyBlob,e.epochStoragePrivateKeyBlob,e.epochAuthPublicKeyBlob,e.epochAuthPrivateKeyBlob],d[29]=a[0],d[30]=a[1],d[31]=a[2],d[32]=a[3],d[33]=a[4],d[34]=a[5],d[35]=a[6],a)):c.seq([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsGenerateLocalKeysStoredProcedure] Fetching keys locally failed. Reason: 24"),d[38]=c.createArray(),f!==f?d[39]=(d[38].push(f),d[38]):0,c.nop(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGenerateLocalKeysStoredProcedure","Fetching keys locally failed. Reason: 24",d[38],c.i64.cast([0,3]))},function(a){return a=[!1,c.blob("ZGV2aWNlX3B1YmxpY19rZXk="),c.blob("ZGV2aWNlX3ByaXZhdGVfa2V5"),c.blob("ZXBvY2hfc3RvcmFnZV9wdWJsaWNfa2V5"),c.blob("ZXBvY2hfc3RvcmFnZV9wcml2YXRlX2tleQ=="),c.blob("ZXBvY2hfYXV0aF9wdWJsaWNfa2V5"),c.blob("ZXBvY2hfYXV0aF9wcml2YXRlX2tleQ==")],d[29]=a[0],d[30]=a[1],d[31]=a[2],d[32]=a[3],d[33]=a[4],d[34]=a[5],d[35]=a[6],a}])},function(a){return a=[d[29],d[30],d[31],d[32],d[33],d[34],d[35]],d[18]=a[0],d[19]=a[1],d[20]=a[2],d[21]=a[3],d[22]=a[4],d[23]=a[5],d[24]=a[6],a}]))})},function(a){return a=[d[18],d[19],d[20],d[21],d[22],d[23],d[24]],d[2]=a[0],d[3]=a[1],d[4]=a[2],d[5]=a[3],d[6]=a[4],d[7]=a[5],d[8]=a[6],a}]):c.seq([function(a){return c.nop(b("LSCreateSignatureKeyPair.nop")).then(function(a){return a=a,d[18]=a[0],d[19]=a[1],a})},function(a){return c.nop(b("LSCreateEncryptionKeyPair.nop")).then(function(a){return a=a,d[20]=a[0],d[21]=a[1],a})},function(a){return c.nop(b("LSCreateAuthKeyPair.nop")).then(function(a){return a=a,d[22]=a[0],d[23]=a[1],a})},function(a){return a=[!0,d[19],d[18],d[21],d[20],d[23],d[22]],d[2]=a[0],d[3]=a[1],d[4]=a[2],d[5]=a[3],d[6]=a[4],d[7]=a[5],d[8]=a[6],a}])},function(a){return d[2]?c.seq([function(a){return c.nop(b("LSCreateSignature_v2.nop"),d[4],c.blob("MA=="),d[5]).then(function(a){return a=a,d[18]=a[0],a})},function(a){return c.nop(b("LSCreateSignature_v2.nop"),d[4],c.blob("MQ=="),d[7]).then(function(a){return a=a,d[19]=a[0],a})},function(a){return d[20]=new c.Map(),d[20].set("device_private_key",d[4]),d[20].set("device_public_key",d[3]),d[21]=new c.Map(),d[21].set("epoch_storage_private_key",d[6]),d[21].set("epoch_storage_public_key",d[5]),d[22]=new c.Map(),d[22].set("epoch_auth_private_key",d[8]),d[22].set("epoch_auth_public_key",d[7]),d[23]=new c.Map(),d[23].set("device_key",d[20]),d[23].set("epoch_storage_key",d[21]),d[23].set("epoch_storage_public_key_sig",d[18]==null?c.blob("bnVsbA=="):d[18]),d[23].set("epoch_auth_key",d[22]),d[23].set("epoch_auth_public_key_sig",d[19]==null?c.blob("bnVsbA=="):d[19]),a=[d[23],f],d[9]=a[0],d[10]=a[1],a}]):c.resolve((d[18]=new c.Map(),d[18].set("error_code",c.i64.cast([0,9])),d[18].set("stored_procedure","LSEncryptedBackupsGenerateLocalKeysStoredProcedure"),d[18].set("error_message",""),a=[f,d[18]],d[9]=a[0],d[10]=a[1],a))},function(a){return d[11]=c.i64.of_float(Date.now()),d[13]="Finishing execution. Execution time: ",d[14]=c.i64.to_string(c.i64.sub(d[11],d[0])),d[16]=" ms",d[12]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][generateLocalKeys] ",d[12],d[13],d[12],d[14],d[12],d[16]].join("")),d[15]=",",d[17]=c.createArray(),f!==f?d[18]=(d[17].push(f),d[17]):0,c.nop(b("LSLogMebClientEvent.nop"),"generateLocalKeys",[d[13],d[15],d[14],d[15],d[16]].join(""),d[17],c.i64.cast([0,4]))},function(a){return a=[d[9],d[10]],e[0]=a[0],e[1]=a[1],a}])},function(a){return c.resolve(e)}])}c=a;f["default"]=c}),66);
__d("LSBase64Decode.nop",["CryptoLogger","LSResult","Promise","base64-js"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a){var b=d("CryptoLogger").CryptoLogger("base64decode");try{return a!=null?d("base64-js").toByteArray(a).buffer:void 0}catch(c){if((c==null?void 0:c.message)==null)return;if(c instanceof Error)b.catching(c).mustfix(c.message);else{b.mustfix("Base64decode : empty error message for exception: %s, input string: %s",c.message,(b=a)!=null?b:"undefined")}}}a=function(a,d,e){return(h||(h=b("Promise"))).resolve(c("LSResult")(i(e)))};g["default"]=a}),98);
__d("ArrayBuffer",["UInt8Array"],(function(a,b,c,d,e,f,g){"use strict";function a(a){a=a.map(function(a){return new Uint8Array(a)});return d("UInt8Array").concatBytes(a).buffer}g.mergeBuffers=a}),98);
__d("LSCreateDebugToken.bs",["ArrayBuffer","Base64Utils","CryptoLogger","I64","LSCreateDerivedKeys.nop","LSCryptoUtils","LSVec","Promise","RetUtil","nullthrows"],(function(a,b,c,d,e,f,g){"use strict";var h,i=d("LSCryptoUtils").strToBuf("debug_token_type_"),j=d("LSCryptoUtils").strToBuf("debug_token_rkid"),k=d("LSCryptoUtils").strToBuf("debug_token_anon"),l=d("I64").of_string("32"),m=d("I64").of_string("12"),n="anon",o="auth";function p(a){return Array.from(a.keys()).reduce(function(b,c){var d=a.get(c);d!=null&&(b[c]=d);return b},{})}function q(a){return new Int32Array([new DataView(new Int32Array([a]).buffer).getInt32(0)]).buffer}function r(a,b){var c=b.length;a=d("ArrayBuffer").mergeBuffers([a,q(c)]);return d("ArrayBuffer").mergeBuffers([a,d("LSCryptoUtils").strToBuf(b)])}function s(a,b){var c=b.keys().sort();return c.reduce(function(a,c){var d=b.get(c);return d!=null?r(r(a,c),d):a},r(i,a))}function t(a,b,d,e,f){return c("LSCreateDerivedKeys.nop")(a,b,d,void 0,e,c("LSVec").ofArray([f])).then(function(a){a=a[0];if(a==null)return void 0;a=c("LSVec").toArray(a);return a.length===1?a[0]:void 0})}function u(a,e,f,g,i){return d("I64").equal(d("I64").zero,i)?t(a,e,k,g,l).then(function(b){return t(a,e,f,c("nullthrows")(b),d("I64").of_int32(f.byteLength))}):(h||(h=b("Promise"))).resolve(f)}function v(a,b,d,e,f,g,h){return t(a,b,d,e,f).then(function(d){return u(a,b,c("nullthrows")(d),g,h)})}function a(a,e,f,g,i,k,q){try{return(h||(h=b("Promise"))).all([t(a,e,s(g,q),f,l).then(function(b){return v(a,e,i,c("nullthrows")(b),m,f,k)}),v(a,e,j,f,m,f,k)]).then(function(a){var b=a[0];a=a[1];return d("RetUtil").getNullableRetResult(d("LSCryptoUtils").strToBuf(JSON.stringify({ctx:d("I64").equal(d("I64").zero,k)?n:o,rkid:d("Base64Utils").fromArrayBuffer(c("nullthrows")(a)),scopes:p(q),type:g,val:d("Base64Utils").fromArrayBuffer(c("nullthrows")(b))})))})}catch(a){d("CryptoLogger").CryptoLogger("create_debug_token").warn("getExn Error");return(h||(h=b("Promise"))).resolve(d("RetUtil").getNullableRetResult())}}g.debugTokenAnonString=n;g.debugTokenAuthString=o;g.call=a}),98);
__d("LSCreateDebugToken.nop",["LSCreateDebugToken.bs"],(function(a,b,c,d,e,f,g){"use strict";a=function(a,b,c,e,f,g,h){return d("LSCreateDebugToken.bs").call(a,b,c,e,f,g,h)};g["default"]=a}),98);
__d("LSGetEncryptionVersionFromSupportedVersionsList",["I64","LSResult","LSVec","Promise"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a,b){if(b.length>0&&!d("I64").gt(a,b[0]))return b[0];else return a}function j(a,b){if(b.length>0&&d("I64").gt(a,b[0]))return b[0];else return a}function k(a,b){return a.filter(function(a){return b.reduce(function(b,c){return b||d("I64").equal(c,a)},!1)})}function l(a){a=a;var b=d("I64").zero;while(a.length>0){var c=a.reduce(k,a[0]);if(c.length>0)return c.sort(function(a,b){return d("I64").compare(b,a)})[0];b=a.reduce(j,d("I64").max_int);c=[];a=a.reduce(function(a,c){c=c.filter(function(a){return d("I64").gt(a,b)});return c.length>0?a.concat([c]):a},c);if(a.length>0)continue;return b}return b}function a(a,e,f){a=c("LSVec").toArray(f).map(function(a){return c("LSVec").toArray(a)});var g=a.reduce(i,d("I64").zero);e=a.map(function(a){return a.filter(function(a){return d("I64").ge(a,g)})}).filter(function(a){return a.length>0});return(h||(h=b("Promise"))).resolve(c("LSResult")(l(e)))}g.call=a}),98);
__d("LSGetEncryptionVersionFromSupportedVersionsList.nop",["LSGetEncryptionVersionFromSupportedVersionsList"],(function(a,b,c,d,e,f,g){"use strict";a=function(a,b,c){return d("LSGetEncryptionVersionFromSupportedVersionsList").call(a,b,c)};g["default"]=a}),98);
__d("ObliviousConsistentMappingFunction",["FBLogger","UInt8Array","nullthrows","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h=c("requireDeferred")("Ristretto255.bs").__setRef("ObliviousConsistentMappingFunction");function i(a){return a.some(function(a){return a!==0})}function j(a){while(!0){var b=a.getRandom();if(i(b))return b;continue}return new Uint8Array(0)}var k=c("nullthrows")(d("UInt8Array").fromHexString("edd3f55c1a631258d69cf7a2def9de1400000000000000000000000000000010"));function l(a){return"ClientState has length "+String(a)+", expected "+String(32)}function a(a){return"ClientState is greater or equal to max: "+a.toString()}var m="ClientState is zero.";function n(a){var b=a.length;if(b!==32)throw c("FBLogger")("labyrinth_web").mustfixThrow(l(b));b=a.reduce(function(b,a){if(b)return!0;else return a>0},!1);if(!b)throw c("FBLogger")("labyrinth_web").mustfixThrow(m);b=!1;for(var d=31;d>=0;--d)if(!b){var e=a[d],f=k[d];if(e>f)throw c("FBLogger")("labyrinth_web").mustfixThrow("ClientState is greater or equal to max: "+a.toString());e<f&&(b=!0)}if(!b)throw c("FBLogger")("labyrinth_web").mustfixThrow("ClientState is greater or equal to max: "+a.toString())}function b(a){n(a);return h.load().then(function(b){var c=j(b.scalar),d=b.scalar.mul(a,c);b=b.scalar.invert(c);return{evolveToken:b,newClientState:d}})}g.checkNonZero=i;g.maxState=k;g.buildInputLengthErrorMsg=l;g.buildInputValueErrorMsg=a;g.getInputZeroErrorMsg=m;g.clientEvolve=b}),98);
__d("LSOcmfClientEvolve_v2.bs",["CryptoLogger","ObliviousConsistentMappingFunction"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c){return d("ObliviousConsistentMappingFunction").clientEvolve(new Uint8Array(c)).then(function(a){return[a.newClientState.buffer,a.evolveToken.buffer]})["catch"](function(a){d("CryptoLogger").captureError(d("CryptoLogger").CryptoLogger("ocmf_client_evolve_v2"),a).mustfix("Failed to evolve client.");throw a})}g.call=a}),98);
__d("LSOcmfClientEvolve_v2.nop",["LSOcmfClientEvolve_v2.bs"],(function(a,b,c,d,e,f,g){"use strict";a=function(a,b,c){return d("LSOcmfClientEvolve_v2.bs").call(a,b,c)};g["default"]=a}),98);/*FB_PKG_DELIM*/
__d("LSUpdateThreadAvatarSticker",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1];b.n;var c=[];return b.seq([function(c){return b.fe(b.db.table(9).fetch([[[a[0]]]]),function(b){var c=b.update;b.item;return c({avatarStickerInstructionKeyId:a[1],avatarStickerId:a[2],avatarStickerThumbnailImageUrl:a[3],avatarStickerThumbnailImageMimeType:a[4],avatarStickerOriginalImageUrl:a[5],avatarStickerOriginalImageMimeType:a[6]})})},function(a){return b.resolve(c)}])}b=a;f["default"]=b}),66);
__d("LSUpdateThreadCustomEmoji",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1];b.n;var c=[];return b.seq([function(c){return b.fe(b.db.table(9).fetch([[[a[0]]]]),function(b){var c=b.update;b.item;return c({customEmoji:a[1],customEmojiImageUrl:a[2]})})},function(a){return b.resolve(c)}])}b=a;f["default"]=b}),66);
__d("LSDeserializeFromJsonIntoDictionaryV2.nop",["I64","LSDict","LSVec","Promise","unrecoverableViolation"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a){function b(a,b){return function(){return function(c){c=a()(c);if(c!=null){var d=c[0];c=c[1];return[b(d),c]}}}}function e(a){return JSON.parse('"'+a+'"')}function f(a){return function(){return function(b){var c=e(a);if(b.startsWith(c))return[c,b.substr(c.length)];else return void 0}}}function g(){for(var a=arguments.length,b=new Array(a),c=0;c<a;c++)b[c]=arguments[c];return function(){return function(a){var c=[];a=a;for(var d=0;d<b.length;d++){var e=b[d];e=e()(a);if(e==null)return void 0;a=e[1];c.push(e[0])}return[c,a]}}}function h(a){return function(){return function(b){var c=a.exec(b);return c!=null?[c,b.substr(c[0].length)]:void 0}}}function i(){for(var a=arguments.length,b=new Array(a),c=0;c<a;c++)b[c]=arguments[c];return function(){return function(a){for(var c=0;c<b.length;c++){var d=b[c];d=d()(a);if(d!=null)return d}}}}function j(a){return function(){return function(b){var c=a()(b);return c!=null?c:[void 0,b]}}}function k(a){return function(){return function(b){var c=a()(b),d=[];b=b;while(c!=null)b=c[1],d.push(c[0]),c=a()(b);return[d,b]}}}var l=h(/^[\n\r\s]*/),m=b(h(/^\"((?:[^\"\\]|\\.)*)\"/),function(a){a=a[1];return e(a)}),n=b(h(/^-?\d+(?:(?:\.\d+)?[eE][-\+]?\d+|\.\d+)/),function(a){a=a[0];return Number(a)});h=b(h(/^-?\d+/),function(a){a=a[0];return d("I64").of_string(a)});var o=b(f("null"),function(a){return null}),p=b(f("true"),function(a){return!0}),q=b(f("false"),function(a){return!1}),r=b(g(l,m,l,f(":"),function(){return s()}),function(a){var b=a[1];a=a[4];return[b,a]});r=b(g(r,k(g(l,f(","),r))),function(a){var b=a[0];a=a[1];return[b].concat(a.map(function(a){a=a[2];return a}))});r=b(g(f("{"),j(r),l,f("}")),function(a){a=a[1];return new(c("LSDict"))((a=a)!=null?a:[])});k=b(g(function(){return s()},k(g(l,f(","),function(){return s()}))),function(a){var b=a[0];a=a[1];return[b].concat(a.map(function(a){a=a[2];return a}))});j=b(g(f("["),l,j(k),l,f("]")),function(a){a=a[2];return c("LSVec").ofArray((a=a)!=null?a:[])});var s=b(g(l,i(r,m,n,h,j,o,p,q),l),function(a){a=a[1];return a});k=s()(a);if(k==null)throw c("unrecoverableViolation")("error parsing string","messenger_web_product");if(k[1]!=="")throw c("unrecoverableViolation")("unexpected "+k[1],"messenger_web_product");return k[0]}a=function(a,d,e){a=i(e);if(a instanceof c("LSDict"))return(h||(h=b("Promise"))).resolve([a]);throw c("unrecoverableViolation")("unexpected Dictionary type","messenger_web_product")};g["default"]=a}),98);
__d("LSUpdateThreadTheme",["LSDeserializeFromJsonIntoDictionaryV2.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1];b.n;var c=[],d=[],e;return b.seq([function(c){return b.fe(b.db.table(9).fetch([[[a[0]]]]),function(b){var c=b.update;b.item;return c({themeFbid:a[1],outgoingBubbleColor:a[2]})})},function(a){return b.resolve(d)}])}b=a;f["default"]=b}),66);/*FB_PKG_DELIM*/
__d("CometProgressButtonIndeterminate.react",["CometProgressRingIndeterminate.react","TetraButton.react","react"],(function(a,b,c,d,e,f,g){"use strict";var h=d("react");function a(a){return h.jsx(c("TetraButton.react"),babelHelpers["extends"]({},a,{addOnPrimary:h.jsx(c("CometProgressRingIndeterminate.react"),{color:"disabled",size:16}),disabled:!0}))}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("LWICometLoggingConstants",[],(function(a,b,c,d,e,f){"use strict";a="1146105192114219";f.APP_ID=a}),66);